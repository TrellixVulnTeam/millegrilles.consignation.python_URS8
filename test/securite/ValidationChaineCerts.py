import logging
from threading import Event

from millegrilles import Constantes
from millegrilles.util.BaseTestMessages import DomaineTest
from millegrilles.SecuritePKI import VerificateurCertificats, EnveloppeCertificat

racine = "-----BEGIN CERTIFICATE-----\nMIIDKDCCAhCgAwIBAgIKAWM2MBd5gxR1ADANBgkqhkiG9w0BAQ0FADAnMQ8wDQYD\nVQQDEwZSYWNpbmUxFDASBgNVBAoTC01pbGxlR3JpbGxlMB4XDTIwMDkwODIzMTEx\nN1oXDTIxMDkwODIzMTExN1owJzEPMA0GA1UEAxMGUmFjaW5lMRQwEgYDVQQKEwtN\naWxsZUdyaWxsZTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBALi6muAN\nrWerhvDAa8OSjGUi9M5/f4yJuIX2SVe4oszKVxvJMSggNNPTnpZCZBSWUSrEpijE\n1MMdFVNrDOS1j4ZxvvYNMvNTOS3m+TJfRL8qwPEMSsu7t9MOHG9FHB0/anPjVeOq\nXC8egzLWkJnXOLtl00BMXVxU8eOLn3KGuHxiKpp/4GbZ8xY7v6G+eUiPoc9uYPI2\nDjrzvZdKVDEgD7kdvoFs68Pj0cJ3bKxp4nds8xNEwguHE6sqElMwEUNJJORjkhzn\n6QTmzDMDaZmndjdG8KiZZKAir9eelS0OZLDIV/UpGo2g2BAxjQekOHPA1aww+KAC\n0B+Q03FBjt/2qpsCAwEAAaNWMFQwEgYDVR0TAQH/BAgwBgEB/wIBBTAdBgNVHQ4E\nFgQUvHQ3HhbAOqkmXTxc0AHjx80EGggwHwYDVR0jBBgwFoAUvHQ3HhbAOqkmXTxc\n0AHjx80EGggwDQYJKoZIhvcNAQENBQADggEBADq5K9FYVVqKwxbInDxvnJ4IsLWD\nQDk/SzCpY15BFm0UFefWRB2hHHuG1/2LvFGvokgh6hzrgjB5qAMGGc5kWL2Pe6Ne\n8/FJE6wGDnqHuTaiq1kOfqP4o3TVb0XDNi6nRZaUGy2NyJAhe7jNS/HG8TtLRZBa\nzPTmIuXxIJt0zWCAmiGCvcYaNDscCOL7Hmt+5w6+4SePnRgWmT8p5sfbLFspKQ8z\n3BFtpLTZYzzdCp4VAzCSfURgvO1WQ6W45gylNGhm7KSBL5fHcj72LhdlAjY3WQoI\nFw9K8maPLpu2cJrA1lt1+fzyF3i0Wv08nSAeFFJbKvwUEPoVxCLDdgQ/FHs=\n-----END CERTIFICATE-----"

vieux_cert_1 = [
    "-----BEGIN CERTIFICATE-----\nMIID8DCCAtigAwIBAgIUUJ1p3k00TlXcm0Y2Ojxm3ObtyHIwDQYJKoZIhvcNAQEL\nBQAwfjEtMCsGA1UEAxMkYTgyZTEzYWEtMjI3Zi00MWFiLWFiYjktOTRiMDc5MmFk\nZjBhMRYwFAYDVQQLEw1pbnRlcm1lZGlhaXJlMTUwMwYDVQQKEyxRRUxFTVhqRTJH\neG5vNFNkOW11c0J2RVMxY2FORTdHdWtzbUY4eG1majNKbzAeFw0yMDEwMTQyMzUy\nNTNaFw0yMDExMTUyMzUyNTNaMF8xNTAzBgNVBAoMLFFFTEVNWGpFMkd4bm80U2Q5\nbXVzQnZFUzFjYU5FN0d1a3NtRjh4bWZqM0pvMRMwEQYDVQQLDAptYWl0cmVjbGVz\nMREwDwYDVQQDDAhtZy1tYXBsZTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoC\nggEBAO7zk4bq2PiTq+YBy4UEFa8yajLFoOnjaMSpm+qBFAycoO+tA8LVuLtdnOps\n6r3AkUXgHjvPb1QgzOnwRfx40BuD2mGJ7gyQWUwhWJlm0TK/0IsQqtjTLBWpWbgQ\n9sKtw3pJigc+InjN0K0DJ9XvbS2tkoLJ2KH+lqjP7FuShi6yDt4bIeS2ZVUB1dYY\nstKvYFjGb7W9oiCN3Va3JRxXhn2p3AQzFNzrI4vrUJJfxxILeyhDt00M7Sbx6P2R\nXaJ9C6AvJzAb3npxFi8MWJQrar48B/SqE6Esewbm1M6BzED4hqMr1+V4YlAQ7viV\nNT7L47S+5K6CKQILDM9FCE99zKMCAwEAAaOBhDCBgTAdBgNVHQ4EFgQU4H96xJ63\n6ErzNTgFcR39Aq3VBQAwHwYDVR0jBBgwFoAUkUXBwkst9/jLu2dl/70yjAbPNbQw\nDAYDVR0TAQH/BAIwADALBgNVHQ8EBAMCBPAwEAYEKgMEAAQINC5zZWN1cmUwEgYE\nKgMEAQQKbWFpdHJlY2xlczANBgkqhkiG9w0BAQsFAAOCAQEAZ5ctI//njz+LYHCC\nHEUzRikNG+K2ZArzpaAJ0vuNsjcSg8auaCNDFNTmHK0eQ0X4g2KHUnNOApJVb2Wa\nSFq6V/wXxcUL/YiMZJWdh0LGb1VxvNkfT+FwoNV0f4EYnnGTwJ5Ygmetu0A+f9Jl\n9f4DPDxIq6EBfH9NPaGNpoKZpbbjVAqJ5qVxmGP9HhOgneM/Of+2oQDE5SbOqvmK\ncKzT13xDG2WacV24U+tq4TTRoJUUh2iWOJRWzEmBsisT4kiVxyO2frwaM/VW8vpg\nRRlHsbRSiQlOqwPa/gXueM6+RtUEpS+ie8bJLcHA+nuk/OGVSSocZ3cqwCu/K6g0\nwx9bZg==\n-----END CERTIFICATE-----",
    "-----BEGIN CERTIFICATE-----\nMIIDfzCCAmegAwIBAgIKBRF2RWcVMRRgADANBgkqhkiG9w0BAQ0FADAnMQ8wDQYD\nVQQDEwZSYWNpbmUxFDASBgNVBAoTC01pbGxlR3JpbGxlMB4XDTIwMTAxNTIzNTIz\nNVoXDTIzMTAxODIzNTIzNVowfjEtMCsGA1UEAxMkYTgyZTEzYWEtMjI3Zi00MWFi\nLWFiYjktOTRiMDc5MmFkZjBhMRYwFAYDVQQLEw1pbnRlcm1lZGlhaXJlMTUwMwYD\nVQQKEyxRRUxFTVhqRTJHeG5vNFNkOW11c0J2RVMxY2FORTdHdWtzbUY4eG1majNK\nbzCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAMHmac+angknuByQn2sT\nzAU6Jn4nPVXnKBluyT6SBUbPiWhyY0gdA9NFK8zb+w6OGWkG/YjtmNxZXhpqpVSv\nC9rBeLbyu/a4TVZy6rsicK//SKabGsAx4FALs4L6b2aC2DZOU5lMfUZiVSQS7jpO\naS9CfEHbtlnnbqQoMW9pqmBcoivLmKoymM7EGlg0h4PU/Hy0ZHhSITtJvG5Z7fAF\nO28vY7lfgGtnX7zPceMm6xou6I+FDcKTRfu28F+B60aJciEDHR3RcH55potHCZCl\naoBoygGxlS9AQvJwMM5+FZBfgmwkWcPbcq6kmJk1pjGLNd+2uelqB5QySX5BC8UA\nKa0CAwEAAaNWMFQwEgYDVR0TAQH/BAgwBgEB/wIBBDAdBgNVHQ4EFgQUkUXBwkst\n9/jLu2dl/70yjAbPNbQwHwYDVR0jBBgwFoAUvHQ3HhbAOqkmXTxc0AHjx80EGggw\nDQYJKoZIhvcNAQENBQADggEBAAE8xQRrmCbvnPg3YhZBWKuVAtcC3QabHcSvWGZn\nOF6RlSLZmE52TqKKL/lFIQMEioOMmlIVhfdd/NwdchhQc5Z1CWdrQbb+Q3inI61r\naydyKLt6CCWSnqivda2Qu4zjgEgW1nU86/7zia623bcwYQEvleFGgbbltOzCucVi\n8GWlRhrhF2PpuXj3SmvOn8GmAq7Y3Qf5ZZUQlDLofupXzfzVUm3NrCzl8i1I+ebz\nuHbXeyP9SAsl/znnBBCz28BxHS2/r0u+miYPfJrMVFUYulh7kaQhudYb8YtJq3QA\nYHc8H+vRkvptzcZ5J2D2U7mqDA1W9blXDsk9jgUMW6J85fc=\n-----END CERTIFICATE-----",
    "-----BEGIN CERTIFICATE-----\nMIIDKDCCAhCgAwIBAgIKAWM2MBd5gxR1ADANBgkqhkiG9w0BAQ0FADAnMQ8wDQYD\nVQQDEwZSYWNpbmUxFDASBgNVBAoTC01pbGxlR3JpbGxlMB4XDTIwMDkwODIzMTEx\nN1oXDTIxMDkwODIzMTExN1owJzEPMA0GA1UEAxMGUmFjaW5lMRQwEgYDVQQKEwtN\naWxsZUdyaWxsZTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBALi6muAN\nrWerhvDAa8OSjGUi9M5/f4yJuIX2SVe4oszKVxvJMSggNNPTnpZCZBSWUSrEpijE\n1MMdFVNrDOS1j4ZxvvYNMvNTOS3m+TJfRL8qwPEMSsu7t9MOHG9FHB0/anPjVeOq\nXC8egzLWkJnXOLtl00BMXVxU8eOLn3KGuHxiKpp/4GbZ8xY7v6G+eUiPoc9uYPI2\nDjrzvZdKVDEgD7kdvoFs68Pj0cJ3bKxp4nds8xNEwguHE6sqElMwEUNJJORjkhzn\n6QTmzDMDaZmndjdG8KiZZKAir9eelS0OZLDIV/UpGo2g2BAxjQekOHPA1aww+KAC\n0B+Q03FBjt/2qpsCAwEAAaNWMFQwEgYDVR0TAQH/BAgwBgEB/wIBBTAdBgNVHQ4E\nFgQUvHQ3HhbAOqkmXTxc0AHjx80EGggwHwYDVR0jBBgwFoAUvHQ3HhbAOqkmXTxc\n0AHjx80EGggwDQYJKoZIhvcNAQENBQADggEBADq5K9FYVVqKwxbInDxvnJ4IsLWD\nQDk/SzCpY15BFm0UFefWRB2hHHuG1/2LvFGvokgh6hzrgjB5qAMGGc5kWL2Pe6Ne\n8/FJE6wGDnqHuTaiq1kOfqP4o3TVb0XDNi6nRZaUGy2NyJAhe7jNS/HG8TtLRZBa\nzPTmIuXxIJt0zWCAmiGCvcYaNDscCOL7Hmt+5w6+4SePnRgWmT8p5sfbLFspKQ8z\n3BFtpLTZYzzdCp4VAzCSfURgvO1WQ6W45gylNGhm7KSBL5fHcj72LhdlAjY3WQoI\nFw9K8maPLpu2cJrA1lt1+fzyF3i0Wv08nSAeFFJbKvwUEPoVxCLDdgQ/FHs=\n-----END CERTIFICATE-----"
]

cert_2 = [
    "-----BEGIN CERTIFICATE-----\nMIIEfjCCA2agAwIBAgIUfDv5w2OqmI4kXcPMFg/HSDhF5w8wDQYJKoZIhvcNAQEL\nBQAwfjEtMCsGA1UEAxMkYTgyZTEzYWEtMjI3Zi00MWFiLWFiYjktOTRiMDc5MmFk\nZjBhMRYwFAYDVQQLEw1pbnRlcm1lZGlhaXJlMTUwMwYDVQQKEyxRRUxFTVhqRTJH\neG5vNFNkOW11c0J2RVMxY2FORTdHdWtzbUY4eG1majNKbzAeFw0yMDExMjUyMzEz\nMTRaFw0yMDEyMjcyMzEzMTRaMGAxNTAzBgNVBAoMLFFFTEVNWGpFMkd4bm80U2Q5\nbXVzQnZFUzFjYU5FN0d1a3NtRjh4bWZqM0pvMRQwEgYDVQQLDAt3ZWJfcHJvdGVn\nZTERMA8GA1UEAwwIbWctbWFwbGUwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEK\nAoIBAQDpzowihP2leXxfRoJHV1DtmV03IyX1aWDqF6TBJvrLbuIPcB+R7XXdOu8O\nnFuX+UkM4+s0rhjq1Qernv/4W42ZKi6vgfvoTs5PIOicrjWSqTItkl5cTYuhH9X8\nmfSu3wsvrfHPku5egcrY2vBu9ts6xuKwLlOUhh3b3lZ0qCbu7EOOeoyd5RU7Qbsr\njHm+8i2oETvKKZTQ+l8oR+/AoawenMKhS7OKFepFeNNv8HfUH0AKwWt2PeCR6rCY\n//JES0e0c9iRsWR7NuxhfMeq2dCezaZhyP8r02EpaVyUhjT5OMkSzBkc7xoLsp/4\ntedeuMUh/zLie9ntNkJ32OL16YrTAgMBAAGjggEQMIIBDDAdBgNVHQ4EFgQUszAq\n+WLUJ84xMS61UeP4mD8H4nEwHwYDVR0jBBgwFoAUkUXBwkst9/jLu2dl/70yjAbP\nNbQwDAYDVR0TAQH/BAIwADALBgNVHQ8EBAMCBPAwIgYEKgMEAAQaMy5wcm90ZWdl\nLDIucHJpdmUsMS5wdWJsaWMwEwYEKgMEAQQLd2ViX3Byb3RlZ2UwdgYDVR0RBG8w\nbYIDd3d3gghtZy1tYXBsZYI2Y291cGRvZWlsLVFFTEVNWGpFMkd4bm80U2Q5bXVz\nQnZFUzFjYU5FN0d1a3NtRjh4bWZqM0pvgghtZy1tYXBsZYIabWctbWFwbGUubWFw\nbGUubWFjZXJvYy5jb20wDQYJKoZIhvcNAQELBQADggEBAJxUsPZvVEiHT6xV3dA6\nbXnzTO3mcpeVpw7ZYaOnsSumnKT3xxrIEEjbhEeuHw6WcEXCogrRxItVEwEa4dgu\n+Yh+08xDpNBUYdcdnhmGDeLpdGldwfzn5Q3wgHErUNdhx1X4KJbA7cTAcVMWShv4\n5GBGxcsSRcxhy/SkmegVIZiykBMcl6R/2oyKy+5zZ5emJ+NLgVIMOhh8j+CABDL3\n7dDzbF/589UHSmvrcB3D9AZQis3wxyK5WwFYLnBwhF8xFdCmGk1mfbkji+ehuAc7\n8mP8uM8V4aohD13CHIDTTRw8sypQSmbroQkzn3/SCEZ+jwA4+gjHgBc77BLxFyaX\nhBM=\n-----END CERTIFICATE-----",
    "-----BEGIN CERTIFICATE-----\nMIIDfzCCAmegAwIBAgIKBRF2RWcVMRRgADANBgkqhkiG9w0BAQ0FADAnMQ8wDQYD\nVQQDEwZSYWNpbmUxFDASBgNVBAoTC01pbGxlR3JpbGxlMB4XDTIwMTAxNTIzNTIz\nNVoXDTIzMTAxODIzNTIzNVowfjEtMCsGA1UEAxMkYTgyZTEzYWEtMjI3Zi00MWFi\nLWFiYjktOTRiMDc5MmFkZjBhMRYwFAYDVQQLEw1pbnRlcm1lZGlhaXJlMTUwMwYD\nVQQKEyxRRUxFTVhqRTJHeG5vNFNkOW11c0J2RVMxY2FORTdHdWtzbUY4eG1majNK\nbzCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAMHmac+angknuByQn2sT\nzAU6Jn4nPVXnKBluyT6SBUbPiWhyY0gdA9NFK8zb+w6OGWkG/YjtmNxZXhpqpVSv\nC9rBeLbyu/a4TVZy6rsicK//SKabGsAx4FALs4L6b2aC2DZOU5lMfUZiVSQS7jpO\naS9CfEHbtlnnbqQoMW9pqmBcoivLmKoymM7EGlg0h4PU/Hy0ZHhSITtJvG5Z7fAF\nO28vY7lfgGtnX7zPceMm6xou6I+FDcKTRfu28F+B60aJciEDHR3RcH55potHCZCl\naoBoygGxlS9AQvJwMM5+FZBfgmwkWcPbcq6kmJk1pjGLNd+2uelqB5QySX5BC8UA\nKa0CAwEAAaNWMFQwEgYDVR0TAQH/BAgwBgEB/wIBBDAdBgNVHQ4EFgQUkUXBwkst\n9/jLu2dl/70yjAbPNbQwHwYDVR0jBBgwFoAUvHQ3HhbAOqkmXTxc0AHjx80EGggw\nDQYJKoZIhvcNAQENBQADggEBAAE8xQRrmCbvnPg3YhZBWKuVAtcC3QabHcSvWGZn\nOF6RlSLZmE52TqKKL/lFIQMEioOMmlIVhfdd/NwdchhQc5Z1CWdrQbb+Q3inI61r\naydyKLt6CCWSnqivda2Qu4zjgEgW1nU86/7zia623bcwYQEvleFGgbbltOzCucVi\n8GWlRhrhF2PpuXj3SmvOn8GmAq7Y3Qf5ZZUQlDLofupXzfzVUm3NrCzl8i1I+ebz\nuHbXeyP9SAsl/znnBBCz28BxHS2/r0u+miYPfJrMVFUYulh7kaQhudYb8YtJq3QA\nYHc8H+vRkvptzcZ5J2D2U7mqDA1W9blXDsk9jgUMW6J85fc=\n-----END CERTIFICATE-----",
    "-----BEGIN CERTIFICATE-----\nMIIDKDCCAhCgAwIBAgIKAWM2MBd5gxR1ADANBgkqhkiG9w0BAQ0FADAnMQ8wDQYD\nVQQDEwZSYWNpbmUxFDASBgNVBAoTC01pbGxlR3JpbGxlMB4XDTIwMDkwODIzMTEx\nN1oXDTIxMDkwODIzMTExN1owJzEPMA0GA1UEAxMGUmFjaW5lMRQwEgYDVQQKEwtN\naWxsZUdyaWxsZTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBALi6muAN\nrWerhvDAa8OSjGUi9M5/f4yJuIX2SVe4oszKVxvJMSggNNPTnpZCZBSWUSrEpijE\n1MMdFVNrDOS1j4ZxvvYNMvNTOS3m+TJfRL8qwPEMSsu7t9MOHG9FHB0/anPjVeOq\nXC8egzLWkJnXOLtl00BMXVxU8eOLn3KGuHxiKpp/4GbZ8xY7v6G+eUiPoc9uYPI2\nDjrzvZdKVDEgD7kdvoFs68Pj0cJ3bKxp4nds8xNEwguHE6sqElMwEUNJJORjkhzn\n6QTmzDMDaZmndjdG8KiZZKAir9eelS0OZLDIV/UpGo2g2BAxjQekOHPA1aww+KAC\n0B+Q03FBjt/2qpsCAwEAAaNWMFQwEgYDVR0TAQH/BAgwBgEB/wIBBTAdBgNVHQ4E\nFgQUvHQ3HhbAOqkmXTxc0AHjx80EGggwHwYDVR0jBBgwFoAUvHQ3HhbAOqkmXTxc\n0AHjx80EGggwDQYJKoZIhvcNAQENBQADggEBADq5K9FYVVqKwxbInDxvnJ4IsLWD\nQDk/SzCpY15BFm0UFefWRB2hHHuG1/2LvFGvokgh6hzrgjB5qAMGGc5kWL2Pe6Ne\n8/FJE6wGDnqHuTaiq1kOfqP4o3TVb0XDNi6nRZaUGy2NyJAhe7jNS/HG8TtLRZBa\nzPTmIuXxIJt0zWCAmiGCvcYaNDscCOL7Hmt+5w6+4SePnRgWmT8p5sfbLFspKQ8z\n3BFtpLTZYzzdCp4VAzCSfURgvO1WQ6W45gylNGhm7KSBL5fHcj72LhdlAjY3WQoI\nFw9K8maPLpu2cJrA1lt1+fzyF3i0Wv08nSAeFFJbKvwUEPoVxCLDdgQ/FHs=\n-----END CERTIFICATE-----",
]

cert_3 = [
    "-----BEGIN CERTIFICATE-----\nMIIEYDCCA0igAwIBAgITFpQCPlcWaV7blv4nZUkVxn4JrjANBgkqhkiG9w0BAQsF\nADB+MS0wKwYDVQQDEyQyYTM2ZWI1Yy1hYzhhLTQyZWYtOGJiMS1kNjc1ODJkYTgw\nYWExFjAUBgNVBAsTDWludGVybWVkaWFpcmUxNTAzBgNVBAoTLFFNRThTamhhQ0Z5\nU0Q5cUJ0MUFpa1ExVTdXeGllSlkyeERnMkpDTWN6SlNUMB4XDTIwMTEyNjIxNTU1\nMFoXDTIwMTIyODIxNTU1MFoweDE1MDMGA1UECgwsUU1FOFNqaGFDRnlTRDlxQnQx\nQWlrUTFVN1d4aWVKWTJ4RGcySkNNY3pKU1QxEDAOBgNVBAsMB21vbml0b3IxLTAr\nBgNVBAMMJDJhMzZlYjVjLWFjOGEtNDJlZi04YmIxLWQ2NzU4MmRhODBhYTCCASIw\nDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAKpBupyjoNI29J1fJQ1ocQOi+j0m\nVo/ItNNeS8LyOgUa4QlvKorI6aoWsS1HydPHl0r2rl6mdlfY+XTijtN1UsmXUXor\nSm2JeEr7Anh8QhtDQ5B/aowhNlUZkGkRZFHGEhkOb56HRjVv/4TCJFElXwsbbHIM\nDjS30YyuSHgMIXvLdZTxgnv7fMCnRU17FkOdPES49aZXAUjvYpQdz9c6cWO4OQUl\nVAXfavYisIRwlckIapViOVHl52ByDeVF7EXfJ/EkzSSoZZOST/uJmSTwYMkftWLG\nNSMWcpm+emSziwERwt36l2fXipd9CQVm4WBZTxc9K+i8/m9/wXqwohF9iIUCAwEA\nAaOB3DCB2TAdBgNVHQ4EFgQUuBGDQGVpHL3xE7jSPzlhgLj0pQAwHwYDVR0jBBgw\nFoAUzV+hAaoF6DelYINqAgbsZdNNDK4wDAYDVR0TAQH/BAIwADALBgNVHQ8EBAMC\nBPAwIgYEKgMEAAQaNC5zZWN1cmUsMy5wcm90ZWdlLDIucHJpdmUwDwYEKgMEAQQH\nbW9uaXRvcjBHBgNVHREEQDA+giQyYTM2ZWI1Yy1hYzhhLTQyZWYtOGJiMS1kNjc1\nODJkYTgwYWGHBH8AAAGHEAAAAAAAAAAAAAAAAAAAAAEwDQYJKoZIhvcNAQELBQAD\nggEBAGa0U6fJSbSRK4gUClHwrZCJ53y/DM7HCJOsfsJPbNDVoRXb1lowLTJmvuA+\noxSgxerU9LyQ6GuxsUgtpuipbD05D+M+2FzT8UIjJu37PfVW2cgZWfaw6JH1tnYl\nPmpKBtF22HzkbAQy2qsXpXNU2efbhvWcW8lFpAQHBN2VzrOajC+1AOPQqfR68v3Q\nyKeoG/tcceVz8HGnH/zy7D1iH49xOWTtG7vvOXHQeE3PKpN5fXllfpYCpZ15UTG6\nYFZihPVELl56wa5MkBrZ+uVFPgZ29tvmnJmoRWEMl64c/IXedWiqWwFkzrwg9Agi\ng1Yj/oJRwNQRp8klq20A4vQ37Ic=\n-----END CERTIFICATE-----",
    "-----BEGIN CERTIFICATE-----\nMIIDfzCCAmegAwIBAgIKBllpdHOHhkVQADANBgkqhkiG9w0BAQ0FADAnMQ8wDQYD\nVQQDEwZSYWNpbmUxFDASBgNVBAoTC01pbGxlR3JpbGxlMB4XDTIwMTEyNzIxNTUz\nNloXDTIzMTEzMDIxNTUzNlowfjEtMCsGA1UEAxMkMmEzNmViNWMtYWM4YS00MmVm\nLThiYjEtZDY3NTgyZGE4MGFhMRYwFAYDVQQLEw1pbnRlcm1lZGlhaXJlMTUwMwYD\nVQQKEyxRTUU4U2poYUNGeVNEOXFCdDFBaWtRMVU3V3hpZUpZMnhEZzJKQ01jekpT\nVDCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAL5bfhqbarzRNMwyCy3j\nmgweWHdpUxGXR7saMFgMP4WKI5BAlfavO5ckyu+BXqAmoeLFQ5bTcVVpY2DygJBJ\n9Cz3bUsFWCv7vUuhbYZndU2BJrOKgbOoYKMgjPMtOvKX20EBaiDcFLnpbhd8avUX\nkae+YhJsvQ0iGoWGephk/ygesgJwmJWJZ5G0Bg0kNVhXZ0VvNA/ycQWNUNAQjURZ\n6QPJv4q8Rg1QIcOldq6vtgrY3ZjkwwCpEelG2ubOdT/SGF9LcvWD5sQFNU6qqklr\nzOkIxPg7xNe4fKRj9AJtRpSIMHPa3w8utCbIsKVM+PK3dnLlXSXTBAKKsHzSeE4y\n5y8CAwEAAaNWMFQwEgYDVR0TAQH/BAgwBgEB/wIBBDAdBgNVHQ4EFgQUzV+hAaoF\n6DelYINqAgbsZdNNDK4wHwYDVR0jBBgwFoAUz0uNp3laAnmytcjpRPxeffzn4YIw\nDQYJKoZIhvcNAQENBQADggEBAGgqYzdLL9sH+GNXOD9XrnpMebqu0dJnQm+57gcr\nqSssRJYF1erRdlTGf6OAWc9+0jISHhbp2mJvOGi7JGgWfY71W0VUX3Je7NnnEzhe\nyNs0CZU/AjNgm3ZaiNdiJk0kfOA7/xEUEbSiGcoS9drLqd2Uwm6Y+C4dmyhW+XIk\nU0NB8m0e/BEP/32ltXiJ8xl+uBQKF0A19tJcsJaz4UnFIfds/F38P33fY5Bjaq3O\nIFnJ/ANnAQ9gw0v6dVGmMm7gOAyPg3wBYOxICB6w2kqOs7c19SRKOJo5OMnw/0/D\nKdgcEjKx8JIfGSM1X9NWvuSEQVcPI7Rg87mneFlhPy736yA=\n-----END CERTIFICATE-----",
    "-----BEGIN CERTIFICATE-----\nMIIDKDCCAhCgAwIBAgIKAwFHBgZAdyMmADANBgkqhkiG9w0BAQ0FADAnMQ8wDQYD\nVQQDEwZSYWNpbmUxFDASBgNVBAoTC01pbGxlR3JpbGxlMB4XDTIwMTAwMTIzMTUz\nNFoXDTIxMTAwMTIzMTUzNFowJzEPMA0GA1UEAxMGUmFjaW5lMRQwEgYDVQQKEwtN\naWxsZUdyaWxsZTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBALN3Oqa0\npme6ckKPaOj9ViWHYbshBZShbr27M4UQbJFuWPGczDuWYRA4o+G2XtYvN7IKix4F\nJk5KAhvaBlX6TERZpqTCbmZDg5okkr7LSUroiH4TSjuPqfAqI2XoeHTKQ4QOEKWd\n53eu+nbtJ9NDnCe6HYs0nNhsH4DluiCWeoPp862mFPs77Vi00JM8WuQZxrzv0kMi\n1izPv0P0DHQ7PLtoVwi7to0GCgXeun4bWGbA3jYjd52IwVSsN34ICLhwu7NxjTEA\nqCmqOoxuwZeF9mtOZpyufMT+9M2yRiQ/M3ORSO0DbiyfnERMSEK1y6cDNIoqSm3E\nKq80fkKUmjeGtwMCAwEAAaNWMFQwEgYDVR0TAQH/BAgwBgEB/wIBBTAdBgNVHQ4E\nFgQUz0uNp3laAnmytcjpRPxeffzn4YIwHwYDVR0jBBgwFoAUz0uNp3laAnmytcjp\nRPxeffzn4YIwDQYJKoZIhvcNAQENBQADggEBADlSMp60EefJ6RezKMf6WP2VYZsC\niM8/HtGmHBk6Y0EEbX0BZlifufrNB3YH8klfYBrxkwPOhku1vaylAtf5xxB3kD+1\nVmxr2mkO9PSJTw+ehDs7tAfOFC/kOy7MCywB/Ysg1oEiQ/uVT51c3zAXDWn+H84k\nVx/4wYGdLVamGVYFU7NSVhzfFED6zZRDn7S+/ncZwhkxmZXIBOl3moWRUA8dBBZp\nkD5whYSBNXy9CnaVaVjMW/AwynM+bBiUlVEXXIUw6wyLdkh76srVpyAGm0kVJ4J/\nCH5fQslgzRhcQBInXaaV+vB9ac624tzpUy+Mt4vmEsoVbDMGZewpH8hFvtM=\n-----END CERTIFICATE-----"
]

event = Event()

class ValiderCertTest(DomaineTest):

    def __init__(self):
        super().__init__()
        self.__logger = logging.getLogger('ValiderCertTest')

        # self.contexte.configuration._mq_config[Constantes.CONFIG_MQ_CA_CERTS] = '/home/mathieu/mgdev/tmp/ca_test.pem'
        self.verificateur = VerificateurCertificats(self.contexte)
        self.verificateur.initialiser()

    def verifier_vieux_cert(self):
        enveloppe = EnveloppeCertificat(certificat_pem=cert_3)
        self.verificateur.valider_x509_enveloppe(enveloppe, ignorer_date=True)

    def executer(self):
        self.verifier_vieux_cert()

        event.set()


# --- MAIN ---
if __name__ == '__main__':
    logging.basicConfig()
    logging.getLogger('millegrilles').setLevel(logging.DEBUG)
    logging.getLogger('ValiderCertTest').setLevel(logging.DEBUG)

    test = ValiderCertTest()
    event.wait(120)

